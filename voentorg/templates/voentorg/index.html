{% extends 'voentorg/base.html' %}
{% load static %}

{% block title %}Военторг - Каталог{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'voentorg/css/main.css' %}">
{% endblock %}

{% block content %}
<!-- Заголовок каталога -->
<div class="catalog-header">
    <h2>Каталог</h2>
    <div class="system-message">
        <i class="fas fa-info-circle"></i>
        <span>Найдено товаров: {{ products|length }}</span>
    </div>
</div>

<div class="catalog-layout">
    <!-- Левая колонка: Фильтры -->
    <aside class="filters-sidebar">
        <h3><i class="fas fa-filter"></i> Фильтры</h3>

        <!-- Категории -->
        <div class="filter-section">
            <h4>Категории</h4>
            <ul class="category-list">
                <li><a href="?category=all" class="{% if not selected_category %}active{% endif %}">Все</a></li>
                {% for category in categories %}
                <li>
                    <a href="?category={{ category.id }}"
                       class="{% if selected_category == category.id %}active{% endif %}">
                        {{ category.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Сортировка -->
        <div class="filter-section">
            <h4>Сортировка</h4>
            <select id="sort-select" class="sort-select">
                <option value="popular" {% if sort == 'popular' %}selected{% endif %}>По популярности</option>
                <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Цена: по возрастанию</option>
                <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Цена: по убыванию</option>
                <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Сначала новые</option>
            </select>
        </div>

        <!-- Цена -->
        <div class="filter-section">
            <h4>Цена</h4>
            <div class="price-range">
                <div class="price-inputs">
                    <input type="number" id="min-price" placeholder="От" min="0" value="{{ min_price|default:0 }}">
                    <span>-</span>
                    <input type="number" id="max-price" placeholder="До" min="0" value="{{ max_price|default:10000 }}">
                </div>
                <div class="price-slider">
                    <input type="range" id="price-slider" min="0" max="10000" value="5000">
                </div>
            </div>
        </div>

        <!-- Кнопки фильтров -->
        <div class="filter-buttons">
            <button class="apply-filters" id="apply-filters">
                <i class="fas fa-check"></i> Применить
            </button>
            <button class="reset-filters" id="reset-filters">
                <i class="fas fa-redo"></i> Сбросить
            </button>
        </div>
    </aside>

    <!-- Правая колонка: Товары -->
    <section class="products-grid">
        {% if products %}
        <div class="products-container" id="products-container">
            {% for product in products %}
            <div class="product-card" data-category="{{ product.category.id }}" data-price="{{ product.price }}" data-id="{{ product.id }}">
                <div class="product-image">
                    {% if product.images.first %}
                    <img src="{{ product.images.first.image }}" alt="{{ product.name }}">
                    {% else %}
                    <img src="https://via.placeholder.com/300x200/2d5a2d/ffffff?text={{ product.name|slice:':20' }}" alt="{{ product.name }}">
                    {% endif %}

                    {% if product.stock < 5 %}
                    <span class="product-badge" style="background-color: #e74c3c;">Заканчивается</span>
                    {% elif forloop.counter <= 3 %}
                    <span class="product-badge">Хит продаж</span>
                    {% endif %}
                </div>
                <div class="product-info">
                    <h3 class="product-title">{{ product.name }}</h3>
                    <div class="product-price">{{ product.price }} ₽</div>

                    <div class="product-colors">
                        <span class="color-dot" style="background-color: #2d5a2d;"></span>
                        <span class="color-dot" style="background-color: #000000;"></span>
                        <span class="color-dot" style="background-color: #5d5d5d;"></span>
                    </div>

                    <div class="product-sessions">
                        <i class="fas fa-box"></i> В наличии: {{ product.stock }} шт.
                    </div>

                    <div class="product-actions">
                        <a href="{% url 'product_detail' product.id %}" class="view-product">
                            <i class="fas fa-eye"></i> Посмотреть
                        </a>
                        <button class="add-to-cart" data-product="{{ product.id }}">
                            <i class="fas fa-cart-plus"></i> В корзину
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-products">
            <i class="fas fa-box-open fa-3x"></i>
            <h3>Товары не найдены</h3>
            <p>Попробуйте изменить параметры фильтрации</p>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'voentorg/js/main.js' %}"></script>
{% endblock %}